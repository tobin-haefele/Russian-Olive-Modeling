---
title: "Russian_Olive_Modeling"
author: "Tobin Haefele"
date: "2025-01-28"
output: html_document
---

```{r setup, include=FALSE}
library(maxnet,warn.conflicts = FALSE)
library(readxl)
library(dplyr)
library(sf)
library(raster)
library(corrplot)
library(ggplot2)
library(tidymodels)
library(blockCV)
library(randomForest)
library(pdp)

knitr::opts_chunk$set(echo = TRUE)
```

## Import data

```{r data import, warning=FALSE}
#import observations for missoula county field survey
survey.df <- read.csv("data/CombinedDataset.csv")

#import missoula county shapefile
msl_shape <- read_sf("data/MontanaStateBoundary_shp/MontanaCounties_shp"
)

msl_shape <- msl_shape %>% filter(NAME == "MISSOULA")


#drop CID column
survey.df <- subset(survey.df, select = -c(CID, EVT_NAME_M,SNAME,GNAME))
```

## Cleaning data

```{r data cleaning, echo=FALSE, message=FALSE, warning=FALSE}



```

## Testing cleaned data

```{r plot, echo=FALSE}


#remove spaces from column names
colnames(survey.df) <- gsub(" ", "_", colnames(survey.df))

msl_shape <- st_transform(msl_shape, crs = 4326)


# Convert survey.df to an sf object
survey_sf <- st_as_sf(survey.df, coords = c("Longitude", "Latitude"), crs = 4326)

#convert PA to factor
survey_sf$PA <- as.factor(survey_sf$PA)

survey_sf <- survey_sf %>%
  mutate_if(is.character, as.factor)


#plot imported points 
ggplot() +
  geom_sf(data = msl_shape) + 
  geom_sf(data=survey_sf)


```

## Prepping the data for modeling

```{r model prep, echo=FALSE}

set.seed(1234)

#split dataset into training/testing 
sb <- cv_spatial(x = survey_sf,
                column = "PA",
                k = 5,
                selection = "random",
                 )

```

## Basic modeling

```{r model, echo=FALSE}
# Train and validate a model using the folds
test_table <- survey_sf
test_table$Pred <- "NA"

for(k in seq_len(length(folds))){
  # Extracting the training and testing indices
  trainSet <- unlist(folds[[k]][1]) # training set indices; first element
  testSet <- unlist(folds[[k]][2]) # testing set indices; second element

  # Train a random forest model
  rf <- randomForest(PA ~ ., st_drop_geometry(survey_sf[trainSet, ]), ntree = 500, importance = TRUE)

  # Predict the test set and store probabilities
  test_table$Pred[testSet] <- predict(rf, st_drop_geometry(survey_sf[testSet, ]), type = "prob")[,2]
}
```

```{r results}
#view the RF 
importance_scores <- importance(rf)
print(importance_scores)

varImpPlot(rf)



```
### Potential Variables to include

-   Wetland Riparian (land cover )
-   Maximum Summer Temp (climate)
-   Frost Free Days (climate)
-   Anthropogenic Influence (land cover)
-   Introduced Vegetation (land cover)
-   Soil pH (soil)
-   Forest - Conifer (land cover)
-   Bulk Density (soil)
-   Degree Days (climate)
-   Distance to Water Edge (hydrography)

### Data sets

<https://geoinfo.msl.mt.gov/msdi/land_use_land_cover> <https://geoinfo.msl.mt.gov/msdi/climate/> <https://prism.oregonstate.edu/> <https://doi.org/10.18113/S1KW2H> (soil)
